version: "3.8"

services:
  harmonia:
    build: .
    container_name: harmonia-dev-gpu
    volumes:
      - ./:/workspace:rw
      - ./models:/workspace/models:rw
    working_dir: /workspace
    tty: true
    environment:
      - PYTHONUNBUFFERED=1
    ports:
      - "8000:8000"
    # Use the 'gpus' option (requires modern Docker Engine + Compose v2):
    # This will make all GPUs available to the container.
    # If your Docker setup uses the NVIDIA Container Toolkit, this is the recommended way.
    gpus: all

# Notes:
# - Ensure the host has NVIDIA drivers installed and the NVIDIA Container Toolkit configured.
# - On Docker Desktop for Windows, enable 'Use the WSL 2 based engine' and enable experimental features if needed.
# - If you prefer to use the older 'runtime: nvidia' approach, add the following under the service:
#   runtime: nvidia
#   (This is less portable and depends on your Docker installation.)
