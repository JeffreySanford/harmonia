#!/usr/bin/env bash

# Pre-commit hook to enforce coding standards
# Installed by: pnpm run prepare

echo "üîç Running pre-commit checks..."

# Run ESLint on staged TypeScript files
echo "  - Checking TypeScript files for lint errors..."
pnpm lint:frontend --quiet || {
  echo "‚ùå ESLint failed. Fix errors and commit again."
  exit 1
}

# Check file sizes using audit script
echo "  - Checking file sizes..."
python scripts/audit_file_sizes.py || {
  echo "‚ùå File size audit failed. Fix oversized files and commit again."
  exit 1
}

# Check for sensitive data in .env
if git diff --cached --name-only | grep -q "^\.env$"; then
  echo "‚ùå Attempting to commit .env file. This is blocked for security."
  echo "   Only commit .env.example with placeholder values."
  exit 1
fi

echo "‚úÖ Pre-commit checks passed!"
exit 0
